<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>POKA V2 - 이미지 편집</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/edit.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00d4ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <div class="app-container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <button class="back-btn" onclick="POKA.Navigation.goBack()">←</button>
                <h1 class="page-title">이미지 편집</h1>
                <div class="header-actions">
                    <button class="header-btn" onclick="debugInfo()" title="디버그">
                        <span class="btn-icon">🐛</span>
                    </button>
                    <button class="header-btn" onclick="loadFromUrl()" title="URL에서 로드">
                        <span class="btn-icon">🔗</span>
                    </button>
                    <button class="header-btn" onclick="saveImage()" title="저장">
                        <span class="btn-icon">💾</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <!-- 이미지 선택 영역 -->
            <section class="image-selection-section" id="imageSelectionSection" style="display: none;">
                <div class="selection-header">
                    <h3 class="section-title">포토카드 이미지 선택</h3>
                    <p class="section-description">앞면과 뒷면에 사용할 이미지를 선택하세요</p>
                </div>
                
                <div class="image-selection-container">
                    <div class="front-image-selection">
                        <h4 class="selection-title">앞면 이미지</h4>
                        <div class="image-grid" id="frontImageGrid">
                            <!-- 업로드된 이미지들이 여기에 표시됩니다 -->
                        </div>
                    </div>
                    
                    <div class="back-image-selection">
                        <h4 class="selection-title">뒷면 이미지</h4>
                        <div class="image-grid" id="backImageGrid">
                            <!-- 업로드된 이미지들이 여기에 표시됩니다 -->
                        </div>
                    </div>
                </div>
                
                <!-- 포토카드 이름 설정 -->
                <div class="photo-card-name-section">
                    <h4 class="selection-title">포토카드 이름</h4>
                    <div class="name-input-container">
                        <input type="text" id="photoCardNameInput" class="name-input" placeholder="포토카드 이름을 입력하세요" maxlength="50">
                        <div class="name-counter">
                            <span id="nameCounter">0</span>/50
                        </div>
                    </div>
                </div>
                
                <div class="selection-actions">
                    <button class="btn btn-primary" onclick="createPhotoCard()" id="createPhotoCardBtn" disabled>
                        <span class="btn-icon">🎴</span>
                        포토카드 만들기
                    </button>
                    <button class="btn btn-secondary" onclick="POKA.Navigation.navigateTo('upload.html')">
                        <span class="btn-icon">📤</span>
                        더 많은 이미지 업로드
                    </button>
                </div>
            </section>

            <!-- 이미지 편집 영역 -->
            <section class="edit-section" id="editSection" style="display: none;">
                <!-- 포토카드 편집 모드일 때만 표시되는 이미지 선택 토글 -->
                <div class="photo-card-edit-controls" id="photoCardEditControls" style="display: none;">
                    <div class="photo-card-image-selector">
                        <h3 class="selector-title">포토카드 이미지 선택</h3>
                        <div class="image-selector-container">
                            <div class="image-selector-item" id="frontImageSelector">
                                <div class="selector-placeholder" onclick="selectImageForUpload('front')">
                                    <span class="placeholder-icon">📷</span>
                                    <span class="placeholder-text">앞면 이미지 선택</span>
                                    <span class="placeholder-hint">클릭하여 이미지 업로드</span>
                                </div>
                                <img class="selected-image" id="frontSelectedImage" src="" alt="앞면 이미지" style="display: none;">
                                <div class="image-overlay" id="frontImageOverlay" style="display: none;">
                                    <button class="edit-btn" onclick="editSelectedImage('front')">
                                        <span class="btn-icon">✏️</span>
                                        <span class="btn-text">편집</span>
                                    </button>
                                    <button class="change-btn" onclick="selectImageForUpload('front')">
                                        <span class="btn-icon">🔄</span>
                                        <span class="btn-text">변경</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="image-selector-item" id="backImageSelector">
                                <div class="selector-placeholder" onclick="selectImageForUpload('back')">
                                    <span class="placeholder-icon">📷</span>
                                    <span class="placeholder-text">뒷면 이미지 선택</span>
                                    <span class="placeholder-hint">클릭하여 이미지 업로드</span>
                                </div>
                                <img class="selected-image" id="backSelectedImage" src="" alt="뒷면 이미지" style="display: none;">
                                <div class="image-overlay" id="backImageOverlay" style="display: none;">
                                    <button class="edit-btn" onclick="editSelectedImage('back')">
                                        <span class="btn-icon">✏️</span>
                                        <span class="btn-text">편집</span>
                                    </button>
                                    <button class="change-btn" onclick="selectImageForUpload('back')">
                                        <span class="btn-icon">🔄</span>
                                        <span class="btn-text">변경</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="photo-card-actions">
                            <button class="btn btn-primary" id="createPhotoCardBtn" onclick="createPhotoCard()" disabled>
                                <span class="btn-icon">🎴</span>
                                <span class="btn-text">포토카드 만들기</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 편집 모드 헤더 -->
                <div class="edit-mode-header" id="editModeHeader" style="display: none;">
                    <div class="edit-mode-info">
                        <button class="back-to-selector-btn" onclick="backToPhotoCardSelector()">
                            <span class="btn-icon">←</span>
                            <span class="btn-text">포토카드 선택으로</span>
                        </button>
                        <div class="current-editing-info">
                            <span class="editing-side-text" id="editingSideText">앞면 편집 중</span>
                        </div>
                    </div>
                </div>
                
                <div class="image-container" id="imageContainer">
                    <img id="editImage" src="" alt="편집할 이미지">
                    <div class="image-fallback" id="imageFallback">
                        🖼️
                    </div>
                    <div class="emoji-layer" id="emojiLayer">
                        <!-- 이모지들이 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
                
                <!-- 편집 도구 -->
                <div class="edit-tools">
                    <div class="tool-group">
                        <h3 class="tool-title">🎨 필터</h3>
                        <div class="filter-buttons">
                            <button class="filter-btn" onclick="resetImage()">원본</button>
                            <button class="filter-btn" onclick="applyFilter('grayscale')">흑백</button>
                            <button class="filter-btn" onclick="applyFilter('sepia')">세피아</button>
                            <button class="filter-btn" onclick="applyFilter('blur')">블러</button>
                            <button class="filter-btn" onclick="applyFilter('brightness')">밝기</button>
                        </div>
                    </div>
                    
                    <div class="tool-group">
                        <h3 class="tool-title">🔄 회전</h3>
                        <div class="rotation-controls">
                            <div class="rotation-buttons">
                                <button class="btn btn-secondary" onclick="rotateImage(-90)" title="왼쪽으로 90도 회전">
                                    <span class="btn-icon">↶</span>
                                    <span class="btn-text">90°</span>
                                </button>
                                <button class="btn btn-secondary" onclick="rotateImage(90)" title="오른쪽으로 90도 회전">
                                    <span class="btn-icon">↷</span>
                                    <span class="btn-text">90°</span>
                                </button>
                                <button class="btn btn-secondary" onclick="rotateImage(180)" title="180도 회전">
                                    <span class="btn-icon">↻</span>
                                    <span class="btn-text">180°</span>
                                </button>
                                <button class="btn btn-secondary" onclick="flipImage('horizontal')" title="좌우 반전">
                                    <span class="btn-icon">↔️</span>
                                    <span class="btn-text">좌우</span>
                                </button>
                                <button class="btn btn-secondary" onclick="flipImage('vertical')" title="상하 반전">
                                    <span class="btn-icon">↕️</span>
                                    <span class="btn-text">상하</span>
                                </button>
                            </div>
                            <div class="rotation-slider">
                                <label for="rotationSlider">정밀 회전: <span id="rotationValue">0°</span></label>
                                <input type="range" id="rotationSlider" min="-180" max="180" value="0" step="1">
                                <div class="rotation-actions">
                                    <button class="btn btn-small" onclick="setRotation(0)">0°</button>
                                    <button class="btn btn-small" onclick="setRotation(45)">45°</button>
                                    <button class="btn btn-small" onclick="setRotation(-45)">-45°</button>
                                    <button class="btn btn-small" onclick="setRotation(90)">90°</button>
                                    <button class="btn btn-small" onclick="setRotation(-90)">-90°</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tool-group">
                        <h3 class="tool-title">😊 이모지 추가</h3>
                        <div class="emoji-controls">
                            <div class="emoji-picker" id="emojiPicker">
                                <button class="emoji-btn" onclick="addEmoji('😊')">😊</button>
                                <button class="emoji-btn" onclick="addEmoji('❤️')">❤️</button>
                                <button class="emoji-btn" onclick="addEmoji('🎉')">🎉</button>
                                <button class="emoji-btn" onclick="addEmoji('⭐')">⭐</button>
                                <button class="emoji-btn" onclick="addEmoji('🔥')">🔥</button>
                                <button class="emoji-btn" onclick="addEmoji('💖')">💖</button>
                                <button class="emoji-btn" onclick="addEmoji('✨')">✨</button>
                                <button class="emoji-btn" onclick="addEmoji('🎵')">🎵</button>
                                <button class="emoji-btn" onclick="addEmoji('🎨')">🎨</button>
                                <button class="emoji-btn" onclick="addEmoji('🌟')">🌟</button>
                                <button class="emoji-btn" onclick="addEmoji('💕')">💕</button>
                                <button class="emoji-btn" onclick="addEmoji('🎊')">🎊</button>
                            </div>
                            <div class="emoji-instructions">
                                <small>💡 이모지 사용법: 드래그로 이동, 클릭으로 삭제</small>
                            </div>
                            <button class="btn btn-secondary" onclick="clearAllEmojis()">모든 이모지 삭제</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 액션 버튼 -->
            <section class="actions-section">
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="resetImage()">
                        <span class="btn-icon">🔄</span>
                        초기화
                    </button>
                    <button class="btn btn-primary" onclick="saveImage()">
                        <span class="btn-icon">💾</span>
                        저장
                    </button>
                    <button class="btn btn-secondary" onclick="downloadImage()">
                        <span class="btn-icon">⬇️</span>
                        다운로드
                    </button>
                </div>
            </section>
        </main>

        <!-- 네비게이션 바 -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-item">
                <span class="nav-icon">🏠</span>
                <span class="nav-text">홈</span>
            </a>
            <a href="upload.html" class="nav-item">
                <span class="nav-icon">📸</span>
                <span class="nav-text">업로드</span>
            </a>
            <a href="gallery.html" class="nav-item">
                <span class="nav-icon">🖼️</span>
                <span class="nav-text">갤러리</span>
            </a>
            <a href="profile.html" class="nav-item">
                <span class="nav-icon">👤</span>
                <span class="nav-text">프로필</span>
            </a>
        </nav>
    </div>

    <script src="js/common.js"></script>
    <script src="js/edit.js"></script>
</body>
</html> 