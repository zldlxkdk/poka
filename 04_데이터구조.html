<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POKA 데이터 구조</title>
    <style>
        body { 
            font-family: 'Malgun Gothic', Arial, sans-serif; 
            margin: 0; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #222; 
            min-height: 100vh;
        }
        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0;
            color: #2c3e50;
            font-size: 2.5em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .header p {
            margin: 10px 0 0 0;
            color: #7f8c8d;
            font-size: 1.1em;
        }
        .nav {
            background: rgba(255,255,255,0.95);
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .nav a {
            color: #3498db;
            text-decoration: none;
            margin: 0 15px;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        .nav a:hover {
            background: #3498db;
            color: white;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto 40px auto; 
            background: #fff; 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            padding: 40px;
            overflow: hidden;
        }
        h2 { 
            color: #3498db; 
            border-bottom: 3px solid #e9ecef; 
            padding-bottom: 10px; 
            margin-top: 0; 
            font-size: 1.8em;
        }
        h3 { 
            color: #2c3e50; 
            margin-top: 30px; 
            font-size: 1.4em;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .feature-card h4 {
            color: #3498db;
            margin-top: 0;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .entity-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .entity-table th {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        .entity-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }
        .entity-table tr:hover {
            background: #f8f9fa;
        }
        .data-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .type.string { background: #28a745; color: white; }
        .type.int { background: #007bff; color: white; }
        .type.bool { background: #ffc107; color: black; }
        .type.datetime { background: #6f42c1; color: white; }
        .type.decimal { background: #fd7e14; color: white; }
        ul {
            margin: 0 0 20px 20px;
            line-height: 1.6;
        }
        .desc {
            color: #555;
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        .er-diagram {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            text-align: center;
        }
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            .entity-table {
                font-size: 0.9em;
            }
            .entity-table th,
            .entity-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>POKA 데이터 구조</h1>
        <p>포토카드 제작 키오스크 시스템 - 데이터 모델 및 스키마 분석</p>
    </div>

    <div class="nav">
        <a href="index.html">🏠 홈</a>
        <a href="01_시스템개요.html">🏗️ 시스템 개요</a>
        <a href="02_주요기능화면.html">📱 주요 기능/화면</a>
        <a href="03_URL_API목록.html">🌐 URL/API 목록</a>
        <a href="05_로그인보안.html">🔐 로그인/보안</a>
        <a href="06_결제업로드.html">💳 결제/업로드</a>
        <a href="07_운영관리.html">⚙️ 운영/관리</a>
        <a href="08_참고부록.html">📚 참고/부록</a>
    </div>

    <div class="container">
        <h2>데이터 구조</h2>
        <div class="desc">
            POKA 시스템은 <b>관계형 데이터베이스</b>와 <b>JSON 기반 API</b>를 사용하여<br>
            포토카드 제작 과정의 모든 데이터를 효율적으로 관리합니다.
        </div>

        <h3>주요 엔티티</h3>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>👤 사용자 (User)</h4>
                <ul>
                    <li><strong>사용자 인증</strong> - 로그인 정보 관리</li>
                    <li><strong>권한 관리</strong> - 역할 기반 접근 제어</li>
                    <li><strong>세션 관리</strong> - JWT 토큰 처리</li>
                    <li><strong>활동 로그</strong> - 사용자 활동 추적</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>📦 주문 (Order)</h4>
                <ul>
                    <li><strong>주문 정보</strong> - 주문 번호, 금액, 상태</li>
                    <li><strong>결제 정보</strong> - 결제 수단, 상태</li>
                    <li><strong>업로드 연동</strong> - 이미지 업로드 ID</li>
                    <li><strong>타임스탬프</strong> - 생성/수정 시간</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>🖼️ 이미지 (Image)</h4>
                <ul>
                    <li><strong>업로드 관리</strong> - 고유 업로드 ID</li>
                    <li><strong>파일 경로</strong> - 얼굴/배경 이미지 URL</li>
                    <li><strong>메타데이터</strong> - 파일 크기, 형식</li>
                    <li><strong>만료 관리</strong> - 자동 삭제 정책</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>⚙️ 설정 (Settings)</h4>
                <ul>
                    <li><strong>시스템 설정</strong> - 환경 설정 값</li>
                    <li><strong>하드웨어 설정</strong> - 프린터/호퍼 설정</li>
                    <li><strong>언어 설정</strong> - 다국어 지원</li>
                    <li><strong>보안 설정</strong> - 인증 정책</li>
                </ul>
            </div>
        </div>

        <h3>엔티티 관계 다이어그램</h3>
        <div class="er-diagram">
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│    User     │    │    Order    │    │    Image    │
├─────────────┤    ├─────────────┤    ├─────────────┤
│ id (PK)     │    │ id (PK)     │    │ id (PK)     │
│ username    │    │ orderId     │    │ uploadId    │
│ password    │    │ amount      │    │ faceUrl     │
│ role        │    │ status      │    │ backUrl     │
│ createdAt   │    │ paymentType │    │ createdAt   │
│ updatedAt   │    │ uploadId    │    │ expiresAt   │
└─────────────┘    │ createdAt   │    └─────────────┘
                   │ updatedAt   │
                   └─────────────┘
                          │
                          │ uploadId (FK)
                          ▼
                   ┌─────────────┐
                   │   Settings  │
                   ├─────────────┤
                   │ id (PK)     │
                   │ key         │
                   │ value       │
                   │ category    │
                   │ updatedAt   │
                   └─────────────┘
        </div>

        <h3>상세 데이터 스키마</h3>

        <h4>사용자 테이블 (Users)</h4>
        <table class="entity-table">
            <tr>
                <th>필드명</th>
                <th>데이터 타입</th>
                <th>제약조건</th>
                <th>설명</th>
            </tr>
            <tr>
                <td>id</td>
                <td><span class="data-type type.int">INT</span></td>
                <td>PRIMARY KEY, AUTO_INCREMENT</td>
                <td>사용자 고유 식별자</td>
            </tr>
            <tr>
                <td>username</td>
                <td><span class="data-type type.string">VARCHAR(50)</span></td>
                <td>UNIQUE, NOT NULL</td>
                <td>사용자명 (로그인 ID)</td>
            </tr>
            <tr>
                <td>password</td>
                <td><span class="data-type type.string">VARCHAR(255)</span></td>
                <td>NOT NULL</td>
                <td>암호화된 비밀번호</td>
            </tr>
            <tr>
                <td>role</td>
                <td><span class="data-type type.string">VARCHAR(20)</span></td>
                <td>NOT NULL, DEFAULT 'user'</td>
                <td>사용자 역할 (admin, kiosk, user)</td>
            </tr>
            <tr>
                <td>isActive</td>
                <td><span class="data-type type.bool">BOOLEAN</span></td>
                <td>NOT NULL, DEFAULT TRUE</td>
                <td>계정 활성화 상태</td>
            </tr>
            <tr>
                <td>lastLoginAt</td>
                <td><span class="data-type type.datetime">DATETIME</span></td>
                <td>NULL</td>
                <td>마지막 로그인 시간</td>
            </tr>
            <tr>
                <td>createdAt</td>
                <td><span class="data-type type.datetime">DATETIME</span></td>
                <td>NOT NULL, DEFAULT CURRENT_TIMESTAMP</td>
                <td>계정 생성 시간</td>
            </tr>
            <tr>
                <td>updatedAt</td>
                <td><span class="data-type type.datetime">DATETIME</span></td>
                <td>NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE</td>
                <td>계정 수정 시간</td>
            </tr>
        </table>

        <h4>주문 테이블 (Orders)</h4>
        <table class="entity-table">
            <tr>
                <th>필드명</th>
                <th>데이터 타입</th>
                <th>제약조건</th>
                <th>설명</th>
            </tr>
            <tr>
                <td>id</td>
                <td><span class="data-type type.int">INT</span></td>
                <td>PRIMARY KEY, AUTO_INCREMENT</td>
                <td>주문 고유 식별자</td>
            </tr>
            <tr>
                <td>orderId</td>
                <td><span class="data-type type.string">VARCHAR(50)</span></td>
                <td>UNIQUE, NOT NULL</td>
                <td>주문 번호 (외부 식별자)</td>
            </tr>
            <tr>
                <td>amount</td>
                <td><span class="data-type type.decimal">DECIMAL(10,2)</span></td>
                <td>NOT NULL</td>
                <td>주문 금액</td>
            </tr>
            <tr>
                <td>status</td>
                <td><span class="data-type type.string">VARCHAR(20)</span></td>
                <td>NOT NULL, DEFAULT 'pending'</td>
                <td>주문 상태 (pending, completed, failed, cancelled)</td>
            </tr>
            <tr>
                <td>paymentType</td>
                <td><span class="data-type type.string">VARCHAR(20)</span></td>
                <td>NOT NULL</td>
                <td>결제 수단 (cash, linepay, coupon)</td>
            </tr>
            <tr>
                <td>uploadId</td>
                <td><span class="data-type type.string">VARCHAR(50)</span></td>
                <td>NOT NULL</td>
                <td>업로드 ID (이미지 연동)</td>
            </tr>
            <tr>
                <td>transactionId</td>
                <td><span class="data-type type.string">VARCHAR(100)</span></td>
                <td>NULL</td>
                <td>외부 결제 거래 ID</td>
            </tr>
            <tr>
                <td>couponCode</td>
                <td><span class="data-type type.string">VARCHAR(20)</span></td>
                <td>NULL</td>
                <td>사용된 쿠폰 코드</td>
            </tr>
            <tr>
                <td>discountAmount</td>
                <td><span class="data-type type.decimal">DECIMAL(10,2)</span></td>
                <td>NULL, DEFAULT 0</td>
                <td>할인 금액</td>
            </tr>
            <tr>
                <td>createdAt</td>
                <td><span class="data-type type.datetime">DATETIME</span></td>
                <td>NOT NULL, DEFAULT CURRENT_TIMESTAMP</td>
                <td>주문 생성 시간</td>
            </tr>
            <tr>
                <td>updatedAt</td>
                <td><span class="data-type type.datetime">DATETIME</span></td>
                <td>NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE</td>
                <td>주문 수정 시간</td>
            </tr>
        </table>

        <h4>이미지 테이블 (Images)</h4>
        <table class="entity-table">
            <tr>
                <th>필드명</th>
                <th>데이터 타입</th>
                <th>제약조건</th>
                <th>설명</th>
            </tr>
            <tr>
                <td>id</td>
                <td><span class="data-type type.int">INT</span></td>
                <td>PRIMARY KEY, AUTO_INCREMENT</td>
                <td>이미지 고유 식별자</td>
            </tr>
            <tr>
                <td>uploadId</td>
                <td><span class="data-type type.string">VARCHAR(50)</span></td>
                <td>UNIQUE, NOT NULL</td>
                <td>업로드 ID (외부 식별자)</td>
            </tr>
            <tr>
                <td>faceUrl</td>
                <td><span class="data-type type.string">VARCHAR(500)</span></td>
                <td>NULL</td>
                <td>얼굴 이미지 URL</td>
            </tr>
            <tr>
                <td>backUrl</td>
                <td><span class="data-type type.string">VARCHAR(500)</span></td>
                <td>NULL</td>
                <td>배경 이미지 URL</td>
            </tr>
            <tr>
                <td>faceSize</td>
                <td><span class="data-type type.int">INT</span></td>
                <td>NULL</td>
                <td>얼굴 이미지 파일 크기 (bytes)</td>
            </tr>
            <tr>
                <td>backSize</td>
                <td><span class="data-type type.int">INT</span></td>
                <td>NULL</td>
                <td>배경 이미지 파일 크기 (bytes)</td>
            </tr>
            <tr>
                <td>status</td>
                <td><span class="data-type type.string">VARCHAR(20)</span></td>
                <td>NOT NULL, DEFAULT 'uploading'</td>
                <td>업로드 상태 (uploading, completed, failed)</td>
            </tr>
            <tr>
                <td>expiresAt</td>
                <td><span class="data-type type.datetime">DATETIME</span></td>
                <td>NOT NULL</td>
                <td>파일 만료 시간</td>
            </tr>
            <tr>
                <td>createdAt</td>
                <td><span class="data-type type.datetime">DATETIME</span></td>
                <td>NOT NULL, DEFAULT CURRENT_TIMESTAMP</td>
                <td>업로드 생성 시간</td>
            </tr>
        </table>

        <h4>설정 테이블 (Settings)</h4>
        <table class="entity-table">
            <tr>
                <th>필드명</th>
                <th>데이터 타입</th>
                <th>제약조건</th>
                <th>설명</th>
            </tr>
            <tr>
                <td>id</td>
                <td><span class="data-type type.int">INT</span></td>
                <td>PRIMARY KEY, AUTO_INCREMENT</td>
                <td>설정 고유 식별자</td>
            </tr>
            <tr>
                <td>key</td>
                <td><span class="data-type type.string">VARCHAR(100)</span></td>
                <td>UNIQUE, NOT NULL</td>
                <td>설정 키</td>
            </tr>
            <tr>
                <td>value</td>
                <td><span class="data-type type.string">TEXT</span></td>
                <td>NOT NULL</td>
                <td>설정 값</td>
            </tr>
            <tr>
                <td>category</td>
                <td><span class="data-type type.string">VARCHAR(50)</span></td>
                <td>NOT NULL</td>
                <td>설정 카테고리 (system, printer, hopper, language)</td>
            </tr>
            <tr>
                <td>description</td>
                <td><span class="data-type type.string">VARCHAR(255)</span></td>
                <td>NULL</td>
                <td>설정 설명</td>
            </tr>
            <tr>
                <td>updatedAt</td>
                <td><span class="data-type type.datetime">DATETIME</span></td>
                <td>NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE</td>
                <td>설정 수정 시간</td>
            </tr>
        </table>

        <h3>JSON 데이터 구조</h3>

        <h4>로그인 요청/응답</h4>
        <div class="code-block">
<b>로그인 요청:</b>
{
    "username": "kiosk_user",
    "password": "kiosk_password"
}

<b>로그인 응답:</b>
{
    "success": true,
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 1200,
    "user": {
        "id": 1,
        "username": "kiosk_user",
        "role": "kiosk",
        "isActive": true,
        "lastLoginAt": "2024-12-01T10:30:00Z"
    }
}
        </div>

        <h4>업로드 URL 응답</h4>
        <div class="code-block">
{
    "success": true,
    "uploadId": "UPLOAD_12345",
    "uploadPageUrl": "https://upload.ting.ovh?id=UPLOAD_12345",
    "expiresAt": "2024-12-01T11:30:00Z",
    "qrCodeData": "https://upload.ting.ovh?id=UPLOAD_12345",
    "image": {
        "id": 1,
        "uploadId": "UPLOAD_12345",
        "faceUrl": null,
        "backUrl": null,
        "status": "uploading",
        "expiresAt": "2024-12-01T11:30:00Z",
        "createdAt": "2024-12-01T10:30:00Z"
    }
}
        </div>

        <h4>주문 생성 요청/응답</h4>
        <div class="code-block">
<b>주문 생성 요청:</b>
{
    "amount": 5000,
    "orderId": "ORDER_20241201_001",
    "uploadId": "UPLOAD_12345",
    "paymentType": "cash"
}

<b>주문 생성 응답:</b>
{
    "success": true,
    "order": {
        "id": 1,
        "orderId": "ORDER_20241201_001",
        "amount": 5000,
        "status": "completed",
        "paymentType": "cash",
        "uploadId": "UPLOAD_12345",
        "transactionId": null,
        "couponCode": null,
        "discountAmount": 0,
        "createdAt": "2024-12-01T10:30:00Z",
        "updatedAt": "2024-12-01T10:30:00Z"
    }
}
        </div>

        <h3>데이터 정규화</h3>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>1️⃣ 1차 정규화</h4>
                <ul>
                    <li>모든 필드는 원자적 값</li>
                    <li>반복되는 그룹 제거</li>
                    <li>기본 키 정의</li>
                    <li>중복 데이터 제거</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>2️⃣ 2차 정규화</h4>
                <ul>
                    <li>부분 함수 종속성 제거</li>
                    <li>복합 키의 일부에만 종속되는 필드 분리</li>
                    <li>주문-결제 정보 분리</li>
                    <li>이미지-메타데이터 분리</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>3️⃣ 3차 정규화</h4>
                <ul>
                    <li>이행 함수 종속성 제거</li>
                    <li>설정 테이블 분리</li>
                    <li>사용자-권한 분리</li>
                    <li>주문-상태 이력 분리</li>
                </ul>
            </div>
        </div>

        <h3>인덱스 전략</h3>
        <div class="code-block">
<b>주요 인덱스:</b>

-- 사용자 테이블
CREATE INDEX idx_users_username ON Users(username);
CREATE INDEX idx_users_role ON Users(role);
CREATE INDEX idx_users_lastLoginAt ON Users(lastLoginAt);

-- 주문 테이블
CREATE INDEX idx_orders_orderId ON Orders(orderId);
CREATE INDEX idx_orders_status ON Orders(status);
CREATE INDEX idx_orders_paymentType ON Orders(paymentType);
CREATE INDEX idx_orders_uploadId ON Orders(uploadId);
CREATE INDEX idx_orders_createdAt ON Orders(createdAt);

-- 이미지 테이블
CREATE INDEX idx_images_uploadId ON Images(uploadId);
CREATE INDEX idx_images_status ON Images(status);
CREATE INDEX idx_images_expiresAt ON Images(expiresAt);

-- 설정 테이블
CREATE INDEX idx_settings_category ON Settings(category);
CREATE INDEX idx_settings_key ON Settings(key);
        </div>

        <h3>데이터 무결성</h3>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>🔒 제약조건</h4>
                <ul>
                    <li><strong>기본 키:</strong> 모든 테이블의 고유 식별자</li>
                    <li><strong>외래 키:</strong> Orders.uploadId → Images.uploadId</li>
                    <li><strong>NOT NULL:</strong> 필수 필드 보장</li>
                    <li><strong>UNIQUE:</strong> 중복 방지</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>🔄 트리거</h4>
                <ul>
                    <li><strong>자동 타임스탬프:</strong> createdAt, updatedAt</li>
                    <li><strong>상태 변경 로그:</strong> 주문 상태 변경 추적</li>
                    <li><strong>파일 만료 처리:</strong> 자동 삭제</li>
                    <li><strong>사용자 활동 로그:</strong> 로그인 기록</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>📊 데이터 검증</h4>
                <ul>
                    <li><strong>금액 검증:</strong> 양수 값만 허용</li>
                    <li><strong>상태 검증:</strong> 유효한 상태값만 허용</li>
                    <li><strong>URL 검증:</strong> 유효한 URL 형식</li>
                    <li><strong>날짜 검증:</strong> 미래 날짜 제한</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>